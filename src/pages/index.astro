---
import { Button } from 'free-astro-components'
import Footer from '../components/Footer.astro'
import Header from '../components/Header.astro'
import Hero from '../sections/Hero.astro'
import Intro from '../sections/Intro.astro'
import Layout from '../layouts/Layout.astro'
import Sidebar from '../layouts/Sidebar.astro'
---

<Layout title="welcome come on~">
  <Sidebar class="lg:hidden" />
  <Header />
  <main>
    <Hero
      align="center"
      title="ç‚¹å…”é¢‘é“ï½œæœ¨ç»“æ„è¡—é“æœåŠ¡å™¨"
      description="è¯·é—®æ‚¨ä»Šå¤©è¦æ¥ç‚¹Minecraftå—ï¼Ÿ"
    >
      <div class="flex flex-wrap justify-center items-center gap-4">
        <Button href="/guide/server_guide" label="ğŸ“– æŸ¥çœ‹æœåŠ¡å™¨æŒ‡å—" />

        <div class="relative" data-dropdown-container>
          <button
            type="button"
            class="btn-pink dropdown-trigger flex items-center justify-center gap-2 px-4 py-2 rounded-md transition-colors"
            aria-haspopup="true"
            aria-expanded="false"
          >
            ğŸ§ åŠ å…¥ç¤¾åŒº <span class="text-xs">â–¼</span>
          </button>
          <div
            class="dropdown-menu absolute top-full mt-2 w-48 origin-top-left rounded-md bg-white p-2 text-left shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none transition-all duration-150 ease-out"
            role="menu"
            aria-orientation="vertical"
          >
            <a
              href="https://qm.qq.com/q/fZDqrHvjHO"
              target="_blank"
              class="block w-full rounded-md px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-100"
              role="menuitem"
            >
              åŠ å…¥QQç¾¤
            </a>
            <a
              href="https://pd.qq.com/s/57mw8fwlg?b=5"
              target="_blank"
              class="block w-full rounded-md px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-100"
              role="menuitem"
            >
              åŠ å…¥QQé¢‘é“
            </a>
          </div>
        </div>
      </div>
    </Hero>
    <Intro />
  </main>
  <Footer />
</Layout>

<style>
  .btn-pink {
    background-color: #FFC0CB;
    color: #18181b;
    border: 1px solid #FFC0CB;
    font-weight: 500;
  }
  .btn-pink:hover {
    background-color: #F8B0BE;
    border-color: #F8B0BE;
  }
  .btn-pink:focus-visible {
    box-shadow: 0 0 0 3px rgba(255, 192, 203, 0.6);
    outline: none;
  }
</style>

<script>
  // å°†äº‹ä»¶å¤„ç†å™¨å®šä¹‰åœ¨å¤–éƒ¨ï¼Œä»¥ä¾¿èƒ½è¢«æ­£ç¡®åœ°æ·»åŠ å’Œç§»é™¤
  let handleDocumentClick: (event: MouseEvent) => void;
  let handleEscKey: (event: KeyboardEvent) => void;

  function initializeDropdown() {
    const dropdownContainer = document.querySelector('[data-dropdown-container]');
    if (!dropdownContainer || dropdownContainer.hasAttribute('data-initialized')) {
      return;
    }
    dropdownContainer.setAttribute('data-initialized', 'true');

    const triggerButton = dropdownContainer.querySelector('.dropdown-trigger') as HTMLElement;
    if (!triggerButton) return;

    const openMenu = () => {
      dropdownContainer.classList.add('open');
      triggerButton.setAttribute('aria-expanded', 'true');
    };

    const closeMenu = () => {
      dropdownContainer.classList.remove('open');
      triggerButton.setAttribute('aria-expanded', 'false');
    };

    const canHover = window.matchMedia('(hover: hover)').matches;

    if (canHover) {
      let openTimeout: ReturnType<typeof setTimeout> | undefined;
      let closeTimeout: ReturnType<typeof setTimeout> | undefined;
      dropdownContainer.addEventListener('mouseenter', () => {
        clearTimeout(closeTimeout);
        openTimeout = setTimeout(openMenu, 200);
      });
      dropdownContainer.addEventListener('mouseleave', () => {
        clearTimeout(openTimeout);
        closeTimeout = setTimeout(closeMenu, 300);
      });
    } else {
      triggerButton.addEventListener('click', (event) => {
        event.stopPropagation();
        dropdownContainer.classList.contains('open') ? closeMenu() : openMenu();
        // å…³é”®ä¿®å¤ï¼šåœ¨ç§»åŠ¨ç«¯ç‚¹å‡»åï¼Œç«‹å³è®©æŒ‰é’®å¤±å»ç„¦ç‚¹ï¼Œå¼ºåˆ¶æ¸…é™¤â€œç²˜æ€§â€çŠ¶æ€
        triggerButton.blur();
      });
    }

    const menuLinks = dropdownContainer.querySelectorAll('.dropdown-menu a');
    menuLinks.forEach(link => {
      link.addEventListener('click', closeMenu);
    });

    handleDocumentClick = (event: MouseEvent) => {
      if (!dropdownContainer.contains(event.target as Node)) {
        closeMenu();
      }
    };
    
    handleEscKey = (event: KeyboardEvent) => {
      if (event.key === 'Escape' && dropdownContainer.classList.contains('open')) {
        closeMenu();
      }
    };

    document.addEventListener('click', handleDocumentClick);
    document.addEventListener('keydown', handleEscKey);
  }

  function cleanupDropdown() {
    // åœ¨é¡µé¢åˆ‡æ¢å‰ï¼Œç§»é™¤æ‰€æœ‰å…¨å±€äº‹ä»¶ç›‘å¬å™¨
    document.removeEventListener('click', handleDocumentClick);
    document.removeEventListener('keydown', handleEscKey);
    // é‡ç½®åˆå§‹åŒ–æ ‡å¿—ï¼Œä»¥ä¾¿æ–°é¡µé¢ä¸Šçš„ç»„ä»¶å¯ä»¥è¢«åˆå§‹åŒ–
    const dropdownContainer = document.querySelector('[data-dropdown-container]');
    if (dropdownContainer) {
      dropdownContainer.removeAttribute('data-initialized');
    }
  }

  // ä½¿ç”¨ Astro æ¨èçš„ã€æœ€å¯é çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
  document.addEventListener('astro:page-load', initializeDropdown);
  document.addEventListener('astro:before-swap', cleanupDropdown);
</script>